3 Two point boundary problems (BVP)

In the following, we will discuss the numerical solution of a two-point boundary value problem of the form

$$u'' + p(x)u' + q(x)u = r(x), a \leq x \leq b, u(a) = u_a, u(b) = u_b,$$

where p, q are given functions of x and the boundary values u_a and u_a are given constants.

A finite difference method for this problem is constructed with the following steps:

**Step 1:** Given the interval [a, b]. Choose some N ∈ N, define the step size h = (b-a)/N, and the grid points x_i = a + ih, i = 0, 1, ..., N.

**Step 2:** For each interior grid point x_i, i = 1, ..., N-1, replace the derivatives by their approximations in the BVP. The result is:

$$\frac{u(x_i+h) - 2u(x_i) + u(x_i-h)}{h^2} + p(x_i)\frac{u(x_i+h) - u(x_i-h)}{2h} + q(x_i)u(x_i) + O(h^2) = r(x_i)$$

for each i = 1, 2 ... N-1, and the term O(h^2) represents the errors in the difference formulas.

**Step 3:** Ignore the error term, and replace the exact solution u(x_i) by its numerical (and still unknown) approximation U_i:

$$\frac{U_{i+1} - 2U_i + U_{i-1}}{h^2} + p(x_i)\frac{U_{i+1} - U_{i-1}}{2h} + q(x_i)U_i = r(x_i), i = 1, \ldots, N-1.$$

This is the discretization of the BVP. If we now include the two boundary values as equations

$$U_0 = u_a \text{ and } U_N = u_b,$$

the discretization is a linear system of equations

$$AU = b,$$

where A is an (N+1) × (N+1) matrix and U = [U_0, ..., U_N]^T. Or more specific, by multiplying the equations by h^2 we end up with:

$$A = \begin{bmatrix} 1 & 0 & & & \ v_1 & d_1 & w_1 & & \ & v_2 & d_2 & w_2 & \ & & v_3 & \ddots & \ddots \ & & & \ddots & \ddots & w_{N-2} \ & & & & v_{N-1} & d_{N-1} & w_{N-1} \ & & & & & 0 & 1 \end{bmatrix}$$

with

$$\begin{align*} v_i &= 1 - \frac{h}{2}p(x_i)\ d_i &= -2 + h^2q(x_i)\ w_i &= 1 + \frac{h}{2}p(x_i) \end{align*}$$

The right hand side b is given by

$$b = [u_a, h^2r(x_1), \ldots, h^2r(x_{N-1}), u_b]^T.$$

Obviously, the first and last equations are trivial to solve, and are therefore often included in the right hand side.

**Step 4:** Solve AU = b with respect to U.

### Example 1:

We consider the equation

$$u'' + 2u' - 3u = 9x, u(0) = u_a = 1, u(1) = u_b = e^{-3} + 2e - 5 \approx 0.486351,$$

with exact solution u(x) = e^{-3x} + 2e^x - 3x - 2.

Choose N, let h = 1/N. Use the central differences for u' and u'', such that

$$\frac{u(x_i+h) - 2u(x_i) + u(x_i-h)}{h^2} + 2\frac{u(x_i+h) - u(x_i-h)}{2h} - 3u(x_i) + O(h^2) = 9x_i, i = 1, \ldots, N.$$

Let U_i ≈ u(x_i). Multiply by h^2 on both sides, include U_0 = u_a og U_N = u_b and clean the mess:

$$\begin{align*} U_0 &= 1,\ (1-h)U_{i-1} + (-2-3h^2)U_i + (1+h)U_{i+1} &= 9x_ih^2, i = 1, \ldots, N-1,\ U_N &= 0.486351. \end{align*}$$

To be even more concrete, for N = 4, we get h = 0.25. The linear system of equations becomes

$$\begin{bmatrix} 1 & 0 & 0 & 0 & 0 \ 0.75 & -2.1875 & 1.25 & 0 & 0 \ 0 & 0.75 & -2.1875 & 1.25 & 0 \ 0 & 0 & 0.75 & -2.1875 & 1.25 \ 0 & 0 & 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} U_0 \ U_1 \ U_2 \ U_3 \ U_4 \end{bmatrix} = \begin{bmatrix}

1. \ 0.140625 \ 0.28125 \ 0.421875 \ 0.48635073 \end{bmatrix}$$

The first and the last equation is trivial to solve, so in practice you have a system of 3 equations in 3 unknowns,

$$\begin{bmatrix} -2.1875 & 1.25 & 0 \ 0.75 & -2.1875 & 1.25 \ 0 & 0.75 & -2.1875 \end{bmatrix} \begin{bmatrix} U_1 \ U_2 \ U_3 \end{bmatrix} = \begin{bmatrix} 0.140625 - 0.75 \cdot 1 \ 0.28125 \ 0.421875 - 1.25 \cdot 0.48635073 \end{bmatrix}$$

with the solution

$$U_1 \approx 0.293176, U_2 \approx 0.025557, U_3 \approx 0.093820.$$

For comparison, the analytic solution in these points is

$$u(0.25) \approx 0.290417, u(0.5) \approx 0.020573, u(0.75) \approx 0.089400.$$

### 3.1 Implementation

For simplicity, the implementation below is only done for BVPs with constant coefficients, that is p(x) = p and q(x) = q. This makes the diagonal, sub- and super-diagonals constant, except at the first and the last row. An extra function is included to construct tridiagonal matrices, that is, matrices where all entries outside the diagonal, sub-diagonal, and super-diagonal are equal to zero.

The implementation consist of:

1. Choose N, let h = (b-a)/N and x_i = a + ih, i = 0, ..., N.
2. Construct the matrix A ∈ R^((N+1)×(N+1)) and the vector b ∈ R^(N+1). The matrix A is tridiagonal, and except from the first and last row, has the elements v = 1 - h/2 p below the diagonal, d = -2 + h^2q as diagonal elements and w = 1 + h/2 p above the diagonal.
3. Construct the vector b = [b_0, ..., b_N]^T with elements b_i = h^2r(x_i) for i = 1, ..., N-1.
4. Modify the first and the last row of the matrix A and the first and last element of the vector b, depending on the boundary conditions.
5. Solve the system AU = b.

```python
def tridiag(v, d, w, N):
    '''
    Help function
    Returns a tridiagonal matrix A=tridiag(v, d, w) of dimension N x N.
    '''
    e = ones(N) # array [1,1,...,1] of length N
    A = v*diag(e[1:],-1)+d*diag(e)+w*diag(e[1:],1)
    return A
# Example 1, BVP
# Define the equation
# u'' + p*u' + q*u = r(x) on the interval [a,b]
# Boundary condition: u(a)=ua and u(b)=ub
p = 2
q = -3
def r(x):
    return 9*x
a, b = 0, 1
ua, ub = 1, exp(-3)+2*exp(1)-5
# The exact solution (if known)
def u_eksakt(x):
    return exp(-3*x)+2*exp(x)-3*x-2
# Set up the discrete system
N = 4 # Number of intervals
# Start the discretization
h = (b-a)/N # Stepsize
x = linspace(a, b, N+1) # The gridpoints x_0=a, x_1=a+h, .... , x_N=b
# Make a draft of the A-matrix (first and last row have to be adjusted)
v = 1-0.5*h*p # Subdiagonal
d = -2+h**2*q # Diagonal
w = 1+0.5*h*p # Superdiagonal
A = tridiag(v, d, w, N+1)
# Make a draft of the b-vector
b = h**2*r(x)
# Modify the first equation (left boundary)
A[0,0] = 1
A[0,1] = 0
b[0] = ua
# Modify the last equation (right boundary)
A[N,N] = 1
A[N,N-1] = 0
b[N] = ub
U = solve(A, b) # Solve the equation
```

To verify the calculations done above, print the matrix A, the vector b and the numerical solution U.

```python
# Print the matrix A, the right hand side b the numerical and exact solution
print('A =\n', A)
print('\nb =\n ', b)
print('\nU =\n ', U)
print('\nu(x)=\n', u_eksakt(x))
# Plot the solution of the BVP
xe = linspace(0,1,101)
plot(x,U,'.-')
plot(xe, u_eksakt(xe),':')
xlabel('x')
ylabel('u')
legend(['Numerical','Exact'])
title('Solution of a two-point BVP');
# Plot the error |u(x)-U| in the gridpoints
error = abs(u_eksakt(x)-U)
plot(x, error,'.-')
xlabel('x')
ylabel('error')
title('Error: u(x)-U');
print('Max error = {:.3e}'.format(max(abs(error))))
```

### 3.2 Boundary conditions

To get a unique solution of a BVP (or a PDE), some information about the solution, usually given on the boundaries has to be known. The most common boundary conditions are:

1. Dirichlet condition: The solution is known at the boundary.
2. Neumann condition: The derivative is known at the boundary.
3. Robin (or mixed) condition: A combination of those.

In the example above, Dirichlet conditions were used. We will now see how to handle Neumann conditions. Robin conditions can be treated similarly.

Given the BVP with a Neumann condition at the left boundary:

$$u'' + p(x)u' + q(x)u = r(x), a \leq x \leq b, u'(a) = u'_a, u(b) = u_b.$$

Here, u'_a is some given value. In this case, the solution u(a) and its corresponding approximation U_0 are unknown, and we need some difference formula also for the point a = x_0. The simplest option is to use a forward difference

$$u'_a = \frac{u(x_1) - u(x_0)}{h} + O(h) \text{ resulting in } \frac{U_1 - U_0}{h} = u'_a,$$

but this is only a first order approximation, and thus lower accuracy is to be expected. We could also use a second order approximation using the values in the grid points x_0, x_1 and x_2, but this will ruin the nice tridiagonal structure of the coefficient matrix. Instead, use the idea of a false boundary:

Assume that the solution can be stretched outside the boundary x = a, all the way to a fictitious grid point x_{-1} = a-h, where we also assume there is an approximate and equally fictitious approximation U_{-1} to u(x_{-1}). Then we have two difference formulas in the point a, one for the BVP itself and a central difference for the boundary conditions:

$$\frac{U_1 - 2U_0 + U_{-1}}{h^2} + p(x_0)\frac{U_1 - U_{-1}}{2h} + q(x_0)U_0 = r(x_0),$$

$$\frac{U_1 - U_{-1}}{2h} = u'_a.$$

We can now solve the second equation with respect to U_{-1}, and insert the solution into the first equation. This yields the new equation

$$\frac{2U_1 - 2U_0 - 2hu'_a}{h^2} + p(x_0)u'_a + q(x_0)U_0 = r(x_0).$$

So the only thing that has changed is the first equation. And since central differences have been used both for the BVP and the boundary condition, the overall order of this approximation can be proved to be 2.

### Example 2:

We consider the same example as before, but now with a Neumann condition at the left boundary:

$$u'' + 2u' - 3u = 9x, u'(0) = u'_a = -4, u(1) = u_b = -2e^{-3} + e - 5 \approx 0.48635073,$$

which has the analytic solution u(x) = e^{-3x} - 2e^x - 3x - 2.

The modified difference equation at the boundary x_0 = 0 is

$$\frac{2U_1 - 2U_0 - 2u'_ah}{h^2} + 2u'_a - 3U_0 = 0.$$

We multiply this equation by h^2, and include the equation as the discretization for the grid point x_0. With this, we obtain the system

$$\begin{align*} (-2 - 3h^2)U_0 - 2U_1 &= (2h - 2h^2)u'_a,\ (1 - h)U_{i-1} + (-2 - 3h^2)U_i + (1 + h)U_{i+1} &= 9h^2x_i, i = 1, \ldots N-1,\ U_N &= u_b, \end{align*}$$

which, for N = 4 and h = 0.25 becomes

$$\begin{bmatrix} -2.1875 & 2 & 0 & 0 & 0 \ 0.75 & -2.1875 & 1.25 & 0 & 0 \ 0 & 0.75 & -2.1875 & 1.25 & 0 \ 0 & 0 & 0.75 & -2.1875 & 1.25 \ 0 & 0 & 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} U_0 \ U_1 \ U_2 \ U_3 \ U_4 \end{bmatrix} = \begin{bmatrix} -1.5 \ 0.140625 \ 0.28125 \ 0.421875 \ 0.48635073 \end{bmatrix}$$

The solution of this is

$$U_0 \approx 0.92103219, U_1 \approx 0.25737896, U_2 \approx 0.01029386, U_3 \approx 0.08858688.$$

**Numerical exercises:**

1. Modify the code above to solve this problem. Use N = 4 to check your solution, but try also N = 10 and N = 20.
2. Modify the code above to solve the same BVP, but now with the left boundary condition u'(a) + u(a)/4 = 0.
